(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61ccdb3a"],{1339:function(t,e,a){"use strict";a("99ae")},"99ae":function(t,e,a){},d6b2:function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{attrs:{visible:t.visible,title:t.title,"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":"",top:"2%"},on:{"update:visible":function(e){t.visible=e},close:t.closeHandle}},[e("el-form",{ref:"dataForm",attrs:{model:t.dataForm,"label-width":"100px",rules:t.dataRule}},[e("el-form-item",{attrs:{label:"统计年份",prop:"year"}},[e("el-date-picker",{attrs:{"value-format":"yyyy",type:"year",placeholder:"请选择统计年份",disabled:t.isFlag},model:{value:t.dataForm.year,callback:function(e){t.$set(t.dataForm,"year",e)},expression:"dataForm.year"}})],1),t.isFlag?t._e():e("el-form-item",{staticClass:"file-desc",attrs:{label:"数据统计表",prop:"file"}},[e("el-row",[e("el-col",[e("el-upload",{ref:"upload1",attrs:{headers:{responseType:"arraybuffer"},accept:".XLS,.xls,.XLSX,.xlsx",action:"#","file-list":t.fileList,"on-change":t.onChange,"on-remove":t.emoveFileHandleXF,"auto-upload":!1}},[e("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("点击上传")]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("\n                                只支持XLS、xls、XLSX、xlsx格式文件,文件大小不超过20M\n                            ")])],1)],1),e("el-col",[e("a",{staticClass:"download_box",attrs:{href:"javascript:;"},on:{click:t.downLoadTemplate}},[t._v("下载Excel模板")])])],1)],1)],1),e("div",{staticClass:"error-hint"},t._l(t.errorHintList,(function(a,l){return e("p",{key:l},[t._v(t._s(a))])})),0),t.isFlag?[e("p",{staticClass:"txt"},[t._v("数据明细")]),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dataListLoading,expression:"dataListLoading"}],ref:"tables",staticClass:"tab",staticStyle:{width:"100%"},attrs:{data:t.dataList,border:"","header-cell-style":{background:"rgba(194, 210, 255, 0.3)",color:"#040415"}}},[e("el-table-column",{attrs:{prop:"city",align:"center",label:"归属地市"}}),e("el-table-column",{attrs:{prop:"target",label:"基本目标值",align:"center"}}),e("el-table-column",{attrs:{prop:"avgMonth",label:"月均",align:"center"}}),e("el-table-column",{attrs:{prop:"month1",label:"1月",align:"center"}}),e("el-table-column",{attrs:{prop:"month2",label:"2月",align:"center"}}),e("el-table-column",{attrs:{prop:"month3",label:"3月",align:"center"}}),e("el-table-column",{attrs:{prop:"month4",label:"4月",align:"center"}}),e("el-table-column",{attrs:{prop:"month5",label:"5月",align:"center"}}),e("el-table-column",{attrs:{prop:"month6",label:"6月",align:"center"}}),e("el-table-column",{attrs:{prop:"month7",label:"7月",align:"center"}}),e("el-table-column",{attrs:{prop:"month8",label:"8月",align:"center"}}),e("el-table-column",{attrs:{prop:"month9",label:"9月",align:"center"}}),e("el-table-column",{attrs:{prop:"month10",label:"10月",align:"center"}}),e("el-table-column",{attrs:{prop:"month11",label:"11月",align:"center"}}),e("el-table-column",{attrs:{prop:"month12",label:"12月",align:"center"}}),e("el-table-column",{attrs:{prop:"monthRate",label:"当月超标比例",align:"center",fixed:"right"}}),e("el-table-column",{attrs:{prop:"totalRate",label:"累计超标比例",align:"center",fixed:"right"}})],1)]:t._e(),t.isFlag?t._e():e("template",{slot:"footer"},[e("el-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:function(e){return t.dataFormSubmitHandle()}}},[t._v("保存")]),e("el-button",{on:{click:function(e){t.visible=!1}}},[t._v(t._s(t.$t("cancel")))])],1)],2)],1)},i=[],r=(a("7f7f"),a("a481"),{props:{title:{type:String,default:function(){return""}},downloadUrl:{type:String,default:function(){return""}}},data:function(){return{dataForm:{id:"",year:"",file:{}},fileList:[],visible:!1,isErrorFlag:!1,errorHintList:[],btnLoading:!1,isFlag:!1,dataListLoading:!1,dataList:[]}},computed:{dataRule:function(){var t=this,e=function(e,a,l){0===t.fileList.length?l(new Error("数据统计表不能上传为空")):l()};return{year:[{required:!0,message:"统计年份不能为空",trigger:"change"}],file:[{required:!0,validator:e,trigger:"change"}]}}},methods:{init:function(){this.visible=!0,this.isErrorFlag=!1,this.errorHintList=[],this.dataForm.year&&this.getListData()},closeHandle:function(){var t=this;this.fileList.length>0&&this.$refs.upload1.clearFiles(),this.fileList=[],this.visible=!1,this.isErrorFlag=!1,this.errorHintList=[],this.dataForm=this.$options.data().dataForm;var e=null;e&&clearTimeout(e),e=setTimeout((function(){t.isFlag=!1}),500),this.$refs["dataForm"].resetFields()},onChange:function(t,e){this.errorHint="",this.isErrorFlag=!1;var a=t.size/1024/1024<21;if(!a)return this.$message.warning("文件大小不能超过20M"),void(this.fileList=[]);var l=t.name.replace(/.+\./,""),i=["XLS","xls","XLSX","xlsx"];if(-1===i.indexOf(l.toLowerCase()))return this.$message.warning("请上传格式正确的文件"),void(this.fileList=[]);e.length>0?(this.fileList=[e[e.length-1]],this.dataForm.file=this.fileList[0].raw,this.$refs["dataForm"].clearValidate("file")):this.$refs["dataForm"].validateField("fileList")},emoveFileHandleXF:function(t){this.fileList=[],this.dataForm.file=null,this.errorHint="",this.isErrorFlag=!1},downLoadTemplate:function(){this.$emit("downLoadTemplate")},dataFormSubmitHandle:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(!e)return!1;if(0!=t.fileList.length){t.btnLoading=!0;var a=new FormData;a.append("file",t.fileList[0].raw),a.append("year",t.dataForm.year),t.$http["post"]("/datamanage/harassmentPhoneComplaint/import",a).then((function(e){var a=e.data;null==a.data.failedMessage||0==a.data.failedMessage.length?(t.$message.success(a.data.successMessage),t.isErrorFlag=!1,t.btnLoading=!1,t.closeHandle(),t.$emit("refreshDataList")):(t.errorHintList=a.data.failedMessage,t.isErrorFlag=!0,t.$message.error("导入失败"),t.$refs.upload1.clearFiles())})).catch((function(){t.btnLoading=!1}))}else t.$message.error("请上传文件")}))},getListData:function(){var t=this;this.dataListLoading=!0,this.$http.get("/datamanage/harassmentPhoneComplaint/info",{params:{yearMon:this.dataForm.year}}).then((function(e){if(0!==e.data.code)return t.dataList=[],t.dataListLoading=!1,t.$message.error(e.data.msg);var a=e.data.data;t.dataList=a,t.dataListLoading=!1}))}}}),s=r,n=(a("1339"),a("2877")),o=Object(n["a"])(s,l,i,!1,null,"3d7d2b04",null);e["default"]=o.exports}}]);