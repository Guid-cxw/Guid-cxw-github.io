(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6083fd82"],{"4ddf":function(e,t,i){"use strict";i("5b70")},"5b70":function(e,t,i){},"6fd2":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.title,width:"800px","close-on-click-modal":!1,"close-on-press-escape":!1,top:"2%"},on:{"update:visible":function(t){e.visible=t},close:e.closeHandle}},[t("div",{staticClass:"up-load"},[t("el-upload",{ref:"upload",staticClass:"model_upload_box",attrs:{drag:"",action:e.url,"on-change":e.handleChange,"before-upload":e.onChange,"show-file-list":!1,headers:{responseType:"arraybuffer",token:e.token},multiple:"","file-list":e.fileList,limit:1,"on-success":e.uploadSuccess,accept:".XLS,.xls,.XLSX,.xlsx","on-error":e.errorHandle}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text",domProps:{innerHTML:e._s("文件大小限制10M")}})])],1),t("div",{staticClass:"follow-tab"},[t("h2",{staticClass:"title"},[e._v("话单")]),t("el-table",{staticClass:"tab",staticStyle:{width:"100%"},attrs:{data:e.flieData,"header-cell-style":{background:"rgba(194, 210, 255, 0.3)",color:"#040415"}}},[t("el-table-column",{attrs:{prop:"fileName",label:"文件名称","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"createDate",label:"上传时间","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:e.$t("handle"),"header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteFileRow(i.row)}}},[e._v("删除")]),i.row.id?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.downLoadFile(i.row)}}},[e._v("\n                        下载\n                    ")]):e._e()]}}])})],1)],1),t("template",{slot:"footer"},[t("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")]),t("el-button",{on:{click:e.closeHandle}},[e._v(e._s(e.$t("cancel")))])],1)],2)},n=[],o=(i("7f7f"),i("a481"),i("2909")),l=i("dea3"),s={props:{},data:function(){return{loading:!1,id:"",title:"",visible:!1,fileList:[],url:"".concat(window.SITE_CONFIG["apiURL"],"/workorder/common/file/uploadFile"),token:this.$getUserToken("token"),flieData:[],detailFileList:[]}},components:{},computed:{},methods:{init:function(){this.visible=!0,this.getInfo()},save:function(){var e,t=this;if(0==this.fileList.length)return this.$message.warning("请先上传文件");this.loading=!0;var i=this.fileList.map((function(e){if(e.response)return{fileName:e.response.data.fileName,filePath:e.response.data.saveFileName,id:t.id}}));(e=this.$http).post.apply(e,["/datamanage/outBoundNotesReport/saveFileRecord"].concat(Object(o["a"])(i))).then((function(e){if(0!=e.data.code)return t.loading=!1,t.$message.error(e.data.msg);t.loading=!1,t.$message.success("修改成功"),t.closeHandle(),t.$emit("refreshDataList")}))},closeHandle:function(){this.visible=!1,this.id="",this.$emit("close")},getInfo:function(){var e=this;this.$http.get("/workorder/common/file/getFileList",{params:{bussinessId:this.id}}).then((function(t){var i=t.data;if(0!==i.code)return e.$message.error(i.msg);e.flieData=i.data})).catch((function(){}))},handleChange:function(e,t){},onChange:function(e){var t=e.name.replace(/.+\./,""),i=["XLS","xls","XLSX","xlsx"];if(-1===i.indexOf(t.toLowerCase()))return this.$message.warning("请上传格式正确的文件"),!1;var a=e.size/1024/1024<11;if(!a)return this.$message.warning("文件大小不能超过10M"),!1;this.fileList=[e]},uploadSuccess:function(e,t,i){this.flieData=[e.data],this.flieData.length>1&&this.flieData.splice(0,1),this.fileList=[]},errorHandle:function(e,t,i){return this.fileList=[],this.getInfo(),this.$message.error("上传失败，请重新上传")},deleteFileRow:function(e){var t=e.id,i=e.fileName;t?this.del(t):(this.flieData=this.flieData.filter((function(e){return e.fileName!=i})),this.fileList=this.fileList.filter((function(e){return e.name!=i})))},del:function(e){var t=this,i=[];i.push(e),this.$confirm("此操作将删除该附件，请确认操作！","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:function(){},beforeClose:function(a,n,o){"confirm"===a?t.$http.post("/workorder/common/file/deleteFile",i).then((function(i){if(0!==i.data.code)return o(),n.confirmButtonLoading=!1,t.$message.error(i.data.msg);n.confirmButtonLoading=!1,o(),t.flieData=t.flieData.filter((function(t){return t.id!=e})),t.$message.success("删除成功")})):o()}}).finally((function(){ctx.confirmButtonLoading=!1})).catch((function(){ctx.confirmButtonLoading=!1}))},downLoadFile:function(e){this.$http({method:"get",withCredentials:!1,timeout:36e4,responseType:"blob",url:"/workorder/common/file/download",params:{fileId:e.id}}).then((function(t){Object(l["a"])(t.data,e.fileName,"")}))}}},r=s,c=(i("4ddf"),i("2877")),d=Object(c["a"])(r,a,n,!1,null,null,null);t["default"]=d.exports}}]);