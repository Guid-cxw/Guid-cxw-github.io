(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-428f98a9"],{8865:function(e,t,a){"use strict";a("e6b1")},daae:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,title:e.title,width:"800px","close-on-click-modal":!1,"close-on-press-escape":!1,top:"2%"},on:{"update:visible":function(t){e.visible=t},close:e.closeHandle}},[t("el-form",{ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataRule,"label-width":"120px",disabled:Boolean(1==e.isShow)}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"title",label:"工单标题"}},[t("el-input",{attrs:{placeholder:"请输入工单标题",clearable:""},model:{value:e.dataForm.title,callback:function(t){e.$set(e.dataForm,"title",t)},expression:"dataForm.title"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"type",label:"工单类型"}},[t("el-select",{attrs:{placeholder:"请选择工单类型",clearable:"",disabled:Boolean(2==e.isShow)},on:{change:e.changeType},model:{value:e.dataForm.type,callback:function(t){e.$set(e.dataForm,"type",t)},expression:"dataForm.type"}},e._l(e.orderTypeList,(function(e){return t("el-option",{key:e.dictValue,attrs:{label:e.dictLabel,value:e.dictValue}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"date",label:"反馈期限"}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions,"default-time":"23:59:59",type:"datetime",placeholder:"选择反馈期限"},model:{value:e.dataForm.date,callback:function(t){e.$set(e.dataForm,"date",t)},expression:"dataForm.date"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:23}},[t("el-form-item",{attrs:{label:"工单说明"}},[t("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入工单说明"},model:{value:e.dataForm.description,callback:function(t){e.$set(e.dataForm,"description",t)},expression:"dataForm.description"}})],1)],1)],1),1!=e.isShow?t("el-row",[t("el-col",{attrs:{span:24}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix box-card-title",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("模板信息")])]),t("div",{staticClass:"btn"},[t("el-upload",{ref:"upload",staticClass:"model_upload_box",attrs:{drag:"",disabled:e.uploadFlag,action:e.url,headers:{responseType:"arraybuffer"},"file-list":e.fileList,"auto-upload":!1,accept:".XLS,.xls,.XLSX,.xlsx","on-change":e.onChange,"on-remove":e.emoveFileHandleMK}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text",domProps:{innerHTML:e._s("只能上传<em>.XLS,.xls,.XLSX,.xlsx</em>格式文件")}})])],1)])],1)],1):e._e(),1!=e.isShow?t("el-row",[t("el-col",{attrs:{span:24}},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix box-card-title",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("附件信息")])]),t("div",{staticClass:"btn"},[t("el-upload",{ref:"appendUpload",staticClass:"model_upload_box",attrs:{drag:"",disabled:e.uploadFlag,action:e.url,headers:{responseType:"arraybuffer"},"file-list":e.appendixFile,multiple:"","auto-upload":!1,limit:10,"on-change":e.onChangeAccessory,"on-remove":e.emoveFileHandleFJ}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text",domProps:{innerHTML:e._s("单个文件不能超过<em>20M</em>,文件数量限制为<em>10个</em>")}})])],1)])],1)],1):e._e(),e.isErrorFlag?t("div",{staticClass:"error-hint"},[t("p",[e._v(e._s(e.errorHint))])]):e._e()],1),1==e.isShow?t("div",[t("el-table",{staticClass:"tab",staticStyle:{width:"100%"},attrs:{data:e.flieData,"header-cell-style":{background:"rgba(194, 210, 255, 0.3)",color:"#040415"}}},[t("el-table-column",{attrs:{prop:"type",label:"文件类型","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"fileName",label:"文件名称","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"updateDate",label:"上传时间","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:e.$t("handle"),"header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.downLoadFile(a.row)}}},[e._v("下载")])]}}],null,!1,1456136793)})],1)],1):e._e(),t("template",{slot:"footer"},[1!=e.isShow?t("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:function(t){2==e.isShow?e.updateDataFormSubmitHandle():e.dataFormSubmitHandle()}}},[e._v("\n            "+e._s(e.$t("confirm"))+"\n        ")]):e._e(),t("el-button",{on:{click:function(t){e.visible=!1}}},[e._v(e._s(e.$t("cancel")))])],1)],2)},r=[],o=(a("8e6e"),a("456d"),a("ac6a"),a("7f7f"),a("a481"),a("ade3")),s=a("b047"),l=a.n(s),n=a("ed08"),d=a("dea3");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(o["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var m={props:{message:{type:String}},data:function(){var e=this;return{pickerOptions:{disabledDate:function(t){if(e.dataForm.id){var a=new Date(e.currentTime),i=a.getTime();return t.getTime()<i}return t.getTime()<Date.now()-864e5}},title:"工单新增",fileList:[],appendixFile:[],url:"#",visible:!1,dataForm:{id:"",title:"",type:"",date:"",file:[],description:""},orderTypeList:Object(n["b"])("orderType"),uploadFlag:!1,templateUrl:"",templateFlag:!1,templateFile:"",flieData:[],errorHint:"",isErrorFlag:!1,timer:null,isShow:0,btnLoading:!1,currentTime:""}},components:{},computed:{dataRule:function(){return{title:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],type:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],date:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},methods:{init:function(){var e=this;this.visible=!0,this.errorHint="",this.isErrorFlag=!1,this.fileList=[],this.appendixFile=[],this.$nextTick((function(){e.$refs["dataForm"].resetFields(),1!=e.isShow&&2!=e.isShow||e.getInfo()}))},closeHandle:function(){var e=this;this.$refs.dataForm.clearValidate(),this.$refs.dataForm.resetFields(),this.dataForm.id="",this.fileList.length>0&&!this.isTab&&(this.$refs.upload.clearFiles(),this.$refs["appendUpload"].clearFiles()),this.visible=!1,this.dataForm.file=[],this.dataForm.appendixFile=[],this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){e.dataForm=e.$options.data().dataForm,e.isShow=0}),500)},getInfo:function(){var e=this;this.$http.get("/workorder/wobase/info",{params:{id:this.dataForm.id}}).then((function(t){var a=t.data;if(0!==a.code)return e.$message.error(a.msg);e.dataForm=p(p({},e.dataForm),a.data),e.dataForm.type=String(a.data.type),e.dataForm.date=a.data.feedbackDeadline,e.flieData=a.data.fileInfoList,e.currentTime=a.data.feedbackDeadline})).catch((function(){}))},onChange:function(e,t){this.errorHint="",this.isErrorFlag=!1;var a=e.size/1024/1024<21;if(!a)return this.$message.warning("文件大小不能超过20M"),void(this.fileList=[]);var i=e.name.replace(/.+\./,""),r=["XLS","xls","XLSX","xlsx"];if(-1===r.indexOf(i.toLowerCase()))return this.$message.warning("请上传格式正确的文件"),void(this.fileList=[]);t.length>0&&(this.fileList=[t[t.length-1]],this.dataForm.file=this.fileList[0].raw)},onChangeAccessory:function(e,t){this.errorHint="",this.isErrorFlag=!1;var a=e.size/1024/1024<21;if(!a)return this.$message.warning("单个文件大小不能超过20M"),void t.pop();t.length>10?t.pop():this.appendixFile=t},emoveFileHandleMK:function(e){this.fileList=[],this.dataForm.file=[],this.errorHint="",this.isErrorFlag=!1},emoveFileHandleFJ:function(e,t){this.appendixFile=t,this.errorHint="",this.isErrorFlag=!1},deleteFileRow:function(e){var t=e.id;this.dataForm.attachmentList=this.dataForm.attachmentList.filter((function(e){return e.id!=t}))},downLoadFile:function(e){this.$http({method:"get",withCredentials:!1,timeout:36e4,responseType:"blob",url:"/workorder/common/file/download",params:{fileId:e.id}}).then((function(t){Object(d["a"])(t.data,e.fileName,"")}))},changeType:function(e){},dataFormSubmitHandle:l()((function(){var e=this;this.$refs["dataForm"].validate((function(t){if(!t)return!1;if(0!=e.fileList.length&&0!=e.appendixFile.length||3==e.dataForm.type){e.btnLoading=!0;var a=new FormData;for(var i in e.dataForm)a.append(i,e.dataForm[i]);e.appendixFile.length>0&&e.appendixFile.forEach((function(e,t){a.append("appendixFileList",e.raw)})),e.$http.post("/workorder/wobase/import",a).then((function(t){var a=t.data;if(0!==a.code)return e.btnLoading=!1,e.isErrorFlag=!0,e.errorHint=a.msg,3==e.dataForm.type&&(e.dataForm=e.$options.data().dataForm),e.$message.error(a.msg);e.btnLoading=!1,e.$message({message:a.msg,type:"success",duration:500,onClose:function(){e.visible=!1,e.closeHandle(),e.$emit("refreshDataList")}})})).catch((function(){e.btnLoading=!1}))}else e.$message.error("请上传文件")}))}),1e3,{leading:!0,trailing:!1}),successHandle:function(e){0==e.code?(this.$message.success("上传成功！"),this.dataForm.attachmentList=this.dataForm.attachmentList.concat(e.data)):(this.$refs.upload.clearFiles(),this.$message.error(e.msg))},updateDataFormSubmitHandle:l()((function(){var e=this;this.$refs["dataForm"].validate((function(t){if(!t)return!1;if(e.fileList.length>0&&0==e.appendixFile.length)return e.$message.error("请上传附件信息文件");if(0==e.fileList.length&&e.appendixFile.length>0)return e.$message.error("请上传模板信息文件");e.btnLoading=!0;var a=new FormData;for(var i in e.dataForm)a.append(i,e.dataForm[i]);e.appendixFile.length>0&&e.appendixFile.forEach((function(e,t){a.append("appendixFileList",e.raw)})),e.$http.post("/workorder/wobase/update/import",a).then((function(t){var a=t.data;if(0!==a.code)return e.btnLoading=!1,e.isErrorFlag=!0,e.errorHint=a.msg,3==e.dataForm.type&&(e.dataForm=e.$options.data().dataForm),e.$message.error(a.msg);e.btnLoading=!1,e.$message({message:a.msg,type:"success",duration:500,onClose:function(){e.visible=!1,e.closeHandle(),e.$emit("refreshDataList")}})})).catch((function(){e.btnLoading=!1}))}))}),1e3,{leading:!0,trailing:!1})}},u=m,f=(a("8865"),a("2877")),h=Object(f["a"])(u,i,r,!1,null,null,null);t["default"]=h.exports},e6b1:function(e,t,a){}}]);