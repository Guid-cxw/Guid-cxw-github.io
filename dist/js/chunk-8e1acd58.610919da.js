(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8e1acd58"],{"1ad2":function(t,a,e){"use strict";e("1d26")},"1d26":function(t,a,e){},e025:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t._self._c;return a("div",[a("el-dialog",{attrs:{visible:t.visible,title:t.title,"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":"",top:"2%",width:t.isFlag?"68%":"50%"},on:{"update:visible":function(a){t.visible=a},close:t.closeHandle}},[a("el-form",{ref:"dataForm",attrs:{model:t.dataForm,"label-width":"100px",rules:t.dataRule}},[a("el-form-item",{attrs:{label:"统计月份",prop:"rankMonth"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM",type:"month",placeholder:"请选择统计月份",disabled:t.isFlag},model:{value:t.dataForm.rankMonth,callback:function(a){t.$set(t.dataForm,"rankMonth",a)},expression:"dataForm.rankMonth"}})],1),t.isFlag?t._e():a("el-form-item",{staticClass:"file-desc",attrs:{label:"数据统计表",prop:"file"}},[a("el-row",[a("el-col",[a("el-upload",{ref:"upload1",attrs:{headers:{responseType:"arraybuffer"},accept:".XLS,.xls,.XLSX,.xlsx",action:"#","file-list":t.fileList,"on-change":t.onChange,"on-remove":t.emoveFileHandleXF,"auto-upload":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("点击上传")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("\n                                只支持XLS、xls、XLSX、xlsx格式文件,文件大小不超过20M\n                            ")])],1)],1),a("el-col",[a("a",{staticClass:"download_box",attrs:{href:"javascript:;"},on:{click:t.downLoadTemplate}},[t._v("下载Excel模板")])])],1)],1)],1),t.isErrorFlag?a("div",{staticClass:"error-hint"},t._l(t.errorHintList,(function(e,i){return a("p",{key:i},[t._v(t._s(e))])})),0):t._e(),t.isFlag?[a("p",{staticClass:"txt"},[t._v("数据明细")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dataListLoading,expression:"dataListLoading"}],ref:"tables",staticClass:"tab",staticStyle:{width:"100%"},attrs:{data:t.dataList,border:"","header-cell-style":{background:"rgba(194, 210, 255, 0.3)",color:"#040415"}}},[a("el-table-column",{attrs:{prop:"city",align:"center",label:"地市"}}),a("el-table-column",{attrs:{prop:"monthDevicesNum",label:"月度设备数",align:"center"}}),a("el-table-column",{attrs:{prop:"monthDensNum",label:"月度窝点数",align:"center"}}),a("el-table-column",{attrs:{prop:"monthPublicity",label:"月度宣传积分",align:"center"}}),a("el-table-column",{attrs:{prop:"monthInnovate",label:"月度创新积分",align:"center"}}),a("el-table-column",{attrs:{prop:"yearDevicesNum",label:"年度累计设备数",align:"center"}}),a("el-table-column",{attrs:{prop:"yearDensNum",label:"年度累计窝点数",align:"center"}}),a("el-table-column",{attrs:{prop:"yearPublicity",label:"年度累计宣传积分",align:"center"}}),a("el-table-column",{attrs:{prop:"yearInnovate",label:"年度累计创新积分",align:"center"}}),a("el-table-column",{attrs:{prop:"score",label:"累计积分",align:"center"}})],1)]:t._e(),t.isFlag?t._e():a("template",{slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:function(a){return t.dataFormSubmitHandle()}}},[t._v("保存")]),a("el-button",{on:{click:function(a){t.visible=!1}}},[t._v(t._s(t.$t("cancel")))])],1)],2)],1)},r=[],l=(e("7f7f"),e("a481"),{props:{title:{type:String,default:function(){return""}},downloadUrl:{type:String,default:function(){return""}}},data:function(){return{dataForm:{id:"",rankMonth:"",file:{}},fileList:[],visible:!1,isErrorFlag:!1,errorHintList:[],btnLoading:!1,isFlag:!1,dataListLoading:!1,dataList:[]}},computed:{dataRule:function(){var t=this,a=function(a,e,i){0===t.fileList.length?i(new Error("数据统计表不能上传为空")):i()};return{month:[{required:!0,message:"统计月份不能为空",trigger:"change"}],file:[{required:!0,validator:a,trigger:"change"}]}}},methods:{init:function(){this.visible=!0,this.isErrorFlag=!1,this.errorHintList=[],this.getListData()},closeHandle:function(){var t=this;this.fileList.length>0&&this.$refs.upload1.clearFiles(),this.fileList=[],this.visible=!1,this.isErrorFlag=!1,this.errorHintList=[],this.dataForm=this.$options.data().dataForm;var a=null;a&&clearTimeout(a),a=setTimeout((function(){t.isFlag=!1}),500),this.$refs["dataForm"].resetFields()},onChange:function(t,a){this.errorHint="",this.isErrorFlag=!1;var e=t.size/1024/1024<21;if(!e)return this.$message.warning("文件大小不能超过20M"),void(this.fileList=[]);var i=t.name.replace(/.+\./,""),r=["XLS","xls","XLSX","xlsx"];if(-1===r.indexOf(i.toLowerCase()))return this.$message.warning("请上传格式正确的文件"),void(this.fileList=[]);a.length>0?(this.fileList=[a[a.length-1]],this.dataForm.file=this.fileList[0].raw,this.$refs["dataForm"].clearValidate("file")):this.$refs["dataForm"].validateField("fileList")},emoveFileHandleXF:function(t){this.fileList=[],this.dataForm.file=null,this.errorHint="",this.isErrorFlag=!1},downLoadTemplate:function(){this.$emit("downLoadTemplate")},dataFormSubmitHandle:function(){var t=this;this.$refs["dataForm"].validate((function(a){if(!a)return!1;if(0!=t.fileList.length){t.btnLoading=!0;var e=new FormData;e.append("file",t.fileList[0].raw),e.append("rankMonth",t.dataForm.rankMonth),t.$http["post"]("/datamanage/catActionRank/importCatActionRankData",e).then((function(a){var e=a.data;0==e.code?(t.$message.success("上传成功"),t.isErrorFlag=!1,t.btnLoading=!1,t.closeHandle(),t.$emit("refreshDataList")):(t.errorHintList=e.data.failedMessage,t.isErrorFlag=!0,t.$message.error("导入失败"),t.$refs.upload1.clearFiles())})).catch((function(){t.btnLoading=!1}))}else t.$message.error("请上传文件")}))},getListData:function(){var t=this;this.dataListLoading=!0,this.$http.get("/datamanage/catActionRank/getInfoList",{params:{rankMonth:this.dataForm.rankMonth}}).then((function(a){if(0!==a.data.code)return t.dataList=[],t.dataListLoading=!1,t.$message.error(a.data.msg);t.dataList=a.data.data,t.dataListLoading=!1}))}},created:function(){}}),n=l,s=(e("1ad2"),e("2877")),o=Object(s["a"])(n,i,r,!1,null,"7161ad68",null);a["default"]=o.exports}}]);